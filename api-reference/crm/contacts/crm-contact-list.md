# Получить список контактов crm.contact.list

> Scope: [`crm`](../../scopes/permissions.md)
>
> Кто может выполнять метод: любой пользователь с правом «чтения» контактов

Метод `crm.contact.list` возвращает список контактов по фильтру. Является реализацией списочного метода для контактов.

{% note info "Получение списка компаний" %}

Для получения списка компаний, привязанных к контакту, используйте метод [`crm.contact.company.items.get`](company/crm-contact-company-items-get.md)

{% endnote %}

## Параметры метода

{% include [Сноска о параметрах](../../../_includes/required.md) %}

#|
|| **Название**
`тип` | **Описание** ||
|| **select**
[`string[]`][1] | Список полей, которые должны быть заполнены у контактов в выборке.

При выборке вы можете использовать маски:
- `'*'` - для выборки всех полей (без пользовательских и множественных)
- `'UF_*'` - для выборки всех пользовательских полей (без множественных)

Маски для выборки множественных полей нет. Для выборки множественных полей укажите нужные в списке выбора ("PHONE", "EMAIL" и так далее).

Список доступных полей для выборки можно узнать посредством метода [`crm.contact.fields`](crm-contact-fields.md)

По умолчанию берутся все поля - `'*'` + Пользовательские поля - `'UF_*'`
||
|| **filter**
[`object`][1] |
Объект формата:
```
{
    field_1: value_1,
    field_2: value_2,
    ...,
    field_n: value_n,
}
```
где
- `field_n` — название поля по которому будет отфильтрована выборка элементов
- `value_n` — значение фильтра

К ключам `field_n` можно добавить префикс, уточняющий работу фильтра.
Возможные значения префикса:
- `>=` — больше либо равно
- `>` — больше
- `<=` — меньше либо равно
- `<` — меньше
- `@` — IN, в качестве значения передается массив
- `!@` — NOT IN, в качестве значения передается массив
- `%` — LIKE, поиск по подстроке. Символ `%` в значении фильтра передавать не нужно. Поиск ищет подстроку в любой позиции строки
- `=%` — LIKE, поиск по подстроке. Символ `%` нужно передавать в значении. Примеры:
    - `"мол%"` — ищет значения, начинающиеся с «мол»
    - `"%мол"` — ищет значения, заканчивающиеся на «мол»
    - `"%мол%"` — ищет значения, где «мол» может быть в любой позиции
- `%=` — LIKE (аналогично `=%`)
- `=` — равно, точное совпадение (используется по умолчанию)
- `!=` — не равно
- `!` — не равно

{% note warning %}

Поля Телефон(`PHONE`), Почта(`EMAIL`), Сайт(`WEB`), Мессенджеры(`IM`), Ссылки(`LINK`) – множественные.
По ним фильтры работают только на точное совпадение.

Так же LIKE фильтр не работает с полями типа `crm_status`, `crm_contact`, `crm_company`. (Тип контакта (`TYPE_ID`), Обращение (`HONORIFIC`) и т.д.)

{% endnote %}

Список доступных полей для фильтрации можно узнать посредством метода [`crm.contact.fields`](crm-contact-fields.md)
||
|| **order**
[`object`][1] |
Объект формата:
```
{
    field_1: value_1,
    field_2: value_2,
    ...,
    field_n: value_n,
}
```
где
- `field_n` — название поля по которому будет произведена сортировка выборки контактов
- `value_n` — значение типа `string` равное:
    - `ASC` — сортировка по возрастанию
    - `DESC` — сортировка по убыванию

Список доступных полей для сортировки можно узнать посредством метода [`crm.contact.fields`](crm-contact-fields.md)
||
|| **start**
[`integer`][1] | Параметр используется для управления постраничной навигацией.

Размер страницы результатов всегда статичный — 50 записей.

Чтобы выбрать вторую страницу результатов, передайте значение `50`. Чтобы выбрать третью страницу результатов — значение `100` и так далее.

Формула расчета значения параметра `start`:

`start = (N-1) * 50`, где `N` — номер нужной страницы
||
|#

Так же смотрите описание [списочных методов](../../how-to-call-rest-api/list-methods-pecularities.md).

## Примеры кода

{% include [Сноска о примерах](../../../_includes/examples.md) %}

**Получить список контактов у которых:**
1. Источником является CRM-Форма
2. Имя и Фамилия не пустые
3. Имя или Фамилия начинается на "И"
4. Участвуют в экспорте
5. E-mail равен 'special-for@example.com'
6. Идентификатор ответственного или 1, или 6
7. Создан менее 6 месяцев назад

**Задать следующий порядок сортировки у данной выборки:**
* Имя и фамилия в порядке возрастания

**Для наглядности выберем только необходимые для нас поля:**
* Идентификатор контакта
* Имя
* Фамилия
* E-mail
* Участвует ли в экспорте
* Ответственный
* Дата создания


{% list tabs %}

- cURL (Webhook)

    ```bash
    todo
    ```

- cURL (OAuth)

    ```bash
    todo
    ```

- JS

    ```js
    const sixMonthAgo = new Date();
    sixMonthAgo.setMonth((new Date()).getMonth() - 6);

    BX24.callMethod(
        'crm.contact.list',
        {
            filter: {
                "SOURCE_ID": "CRM_FORM",
                "!=NAME": "",
                "!=LAST_NAME": "",
                "0": {
                    "LOGIC": "OR",
                    "0": {
                        "=%NAME": "И%",
                    },
                    "1": {
                        "=%LAST_NAME": "И%",
                    },
                },
                "EMAIL": "special-for@example.com",
                "@ASSIGNED_BY_ID": [1, 6],
                "IMPORT": "Y",
                ">=DATE_CREATE": sixMonthAgo.toISOString(),
            },
            order: {
                LAST_NAME: "ASC",
                NAME: "ASC",
            },
            select: [
                "ID",
                "NAME",
                "LAST_NAME",
                "EMAIL",
                "EXPORT",
                "ASSIGNED_BY_ID",
                "DATE_CREATE",
            ],
        },
        (result) => {
            result.error()
                ? console.error(result.error())
                : console.info(result.data())
            ;
        },
    );
    ```

- PHP

    ```php
    todo
    ```

{% endlist %}


## Обработка ответа

HTTP-статус: **200**

```json
{
	"result": [
		{
			"ID": "75",
			"NAME": "Анастасия",
			"LAST_NAME": "Ильина",
			"EXPORT": "Y",
			"ASSIGNED_BY_ID": "6",
			"DATE_CREATE": "2024-02-26T00:00:00+02:00",
			"EMAIL": [
				{
					"ID": "215",
					"VALUE_TYPE": "WORK",
					"VALUE": "special-for@example.com",
					"TYPE_ID": "EMAIL"
				}
			]
		},
		{
			"ID": "74",
			"NAME": "Артем",
			"LAST_NAME": "Исаев",
			"EXPORT": "Y",
			"ASSIGNED_BY_ID": "1",
			"DATE_CREATE": "2024-08-15T00:00:00+02:00",
			"EMAIL": [
				{
					"ID": "214",
					"VALUE_TYPE": "WORK",
					"VALUE": "special-for@example.com",
					"TYPE_ID": "EMAIL"
				}
			]
		},
		{
			"ID": "78",
			"NAME": "Артем",
			"LAST_NAME": "Исаев",
			"EXPORT": "Y",
			"ASSIGNED_BY_ID": "1",
			"DATE_CREATE": "2024-08-15T00:00:00+02:00",
			"EMAIL": [
				{
					"ID": "218",
					"VALUE_TYPE": "WORK",
					"VALUE": "special-for@example.com",
					"TYPE_ID": "EMAIL"
				}
			]
		},
		{
			"ID": "77",
			"NAME": "Инна",
			"LAST_NAME": "Кузнецова",
			"EXPORT": "Y",
			"ASSIGNED_BY_ID": "6",
			"DATE_CREATE": "2024-07-01T00:00:00+02:00",
			"EMAIL": [
				{
					"ID": "217",
					"VALUE_TYPE": "WORK",
					"VALUE": "special-for@example.com",
					"TYPE_ID": "EMAIL"
				}
			]
		},
		{
			"ID": "73",
			"NAME": "Иван",
			"LAST_NAME": "Петров",
			"EXPORT": "Y",
			"ASSIGNED_BY_ID": "1",
			"DATE_CREATE": "2024-02-20T00:00:00+02:00",
			"EMAIL": [
				{
					"ID": "213",
					"VALUE_TYPE": "WORK",
					"VALUE": "special-for@example.com",
					"TYPE_ID": "EMAIL"
				}
			]
		}
	],
	"total": 5,
	"time": {
		"start": 1723807142.916445,
		"finish": 1723807143.44846,
		"duration": 0.5320150852203369,
		"processing": 0.1967020034790039,
		"date_start": "2024-08-16T13:19:02+02:00",
		"date_finish": "2024-08-16T13:19:03+02:00"
	}
}
```

### Возвращаемые значения

#|
|| **Название**
`тип` | **Описание** ||
|| **result**
[`contact[]`](crm-contact-get.md#contact) | Корневой элемент ответа. Массив, содержащий информацию о найденных контактах.

Поля отдельно взятого контакта конфигурируются параметром `select` ||
|| **total**
[`integer`][1] | Общее количество найденных контактов по заданным условиям ||
|| **next**
[`integer`][1] | Содержит значение, которое нужно передать в следующий запрос в параметр `start`, чтобы получить следующую порцию данных.

Параметр `next` появляется в ответе, если количество элементов, соответствующих вашему запросу, превышает значение `50`. ||
|| **time**
[`time`][1] | Информация о времени выполнения запроса ||
|#

## Обработка ошибок

HTTP-статус: **400**

```json
{
  "error": "",
  "error_description": "Access denied."
}
```

{% include notitle [обработка ошибок](../../../_includes/error-info.md) %}

### Возможные коды ошибок

#|
|| **Код** | **Описание** | **Значение** ||
|| `-`     | Access denied. | У пользователя нет прав на "Чтение" контактов ||
|| `-`     | Parameter 'order' must be array. | В параметр `order` передан не массив ||
|| `-`     | Parameter 'filter' must be array. | В параметр `filter` передан не массив ||
|| `-`     | Failed to get list. General error. | Произошла неизвестная ошибка ||
|#

{% include [системные ошибки](./../../../_includes/system-errors.md) %}

## Продолжите изучение

- [{#T}](crm-contact-fields.md)
- [{#T}](crm-contact-add.md)
- [{#T}](crm-contact-update.md)
- [{#T}](crm-contact-get.md)
- [{#T}](crm-contact-delete.md)


[1]: ../../data-types.md
