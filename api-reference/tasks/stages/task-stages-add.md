# Добавление стадии Канбана / Моего плана

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- не указаны типы параметров
- не указана обязательность параметров
- отсутствуют примеры (должно быть три примера - curl, js, php)
- отсутствует ответ в случае ошибки
- отсутствует ответ в случае успеха
  
{% endnote %}

{% endif %}

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

> Название метода: **task.stages.add**
>
> Scope: [`task`](../../scopes/permissions.md)
>
> Кто может выполнять метод: `любой пользователь`

Метод  добавляет стадию Канбана / Моего плана.

## Параметры метода

#|
|| **Название** `тип`  | **Описание** ||
|| **fields***
[`object`](../../data-types.md) | Значения полей (подробное описание приведено ниже) для добавления стадии в виде структуры:

```js
fields: {
    TITLE: "значение",
    COLOR: "значение",
    AFTER_ID: "значение",
    ENTITY_ID: "значение",
},
```

||
|| **isAdmin**
[`boolean`](../../data-types.md) | Если установлено `true`, то проверки прав происходить не будет. При условии, что запрашивающий является администратором портала.
||
|#

## Параметр fields

#|
|| **Название** `тип` | **Описание** ||
|| **TITLE*** [`string`](../../data-types.md) | Заголовок стадии. ||
|| **COLOR** [`string`](../../data-types.md) | Цвет стадии. ||
|| **AFTER_ID** [`integer`](../../data-types.md) | Идентификатор стадии, после которой надо добавить новую стадию. Если не указано или равно `0`, то добавится в начало. ||
|| **ENTITY_ID** [`integer`](../../data-types.md)| Идентификатор сущности. Может равняться `ID` группы, тогда стадия добавится в Канбан группы. При недостаточном уровне прав выводится ошибка доступа. Если равняется `0` или отсутствует, то стадия добавляется в Мой план текущего пользователя. ||
|#

## Примеры кода

{% include [Сноска о примерах](../../../_includes/examples.md) %}

{% list tabs %}

- JS
  
    ```js
    BX24.callMethod(
        'task.stages.add',
        {
            fields: {
                TITLE: 'Название стадии',
                COLOR: '#FFAAEE',
                AFTER_ID: 1,
                ENTITY_ID: 1
            },
            isAdmin: false,
        },
        function(result) {
            if (result.error()) {
                console.error(result.error());
            } else {
                console.info(result.data());
            }
        }
    );
    ```

{% endlist %}

## Обработка ответа

HTTP-статус: **200**

```json
{
    "result": 1,
    "time":{
        "start":1712218058.514339,
        "finish":1712218060.34603,
        "duration":1.831691026687622,
        "processing":0.042268991470336914,
        "date_start":"2024-04-04T11:07:38+03:00",
        "date_finish":"2024-04-04T11:07:40+03:00"
    }
}
```

### Возвращаемые данные

#|
|| **Название**
`тип` | **Описание** ||
|| **result**
[`int`](../../data-types.md) | Возвращает `ID` добавленной стадии. ||
|| **time**
[`time`](../../data-types.md) | Информация о времени выполнения запроса ||
|#

## Обработка ошибок

HTTP-статус: **400**

```json
{
    "error": "EMPTY_TITLE",
    "error_description": "Не указан заголовок стадии"
}
```

{% include notitle [обработка ошибок](../../../_includes/error-info.md) %}

### Возможные коды ошибок

#|
|| **Код** | **Описание** ||
|| `EMPTY_TITLE` | Не указан заголовок стадии ||
|| `ACCESS_DENIED` | Вы не можете управлять стадиями ||
|#

{% include [системные ошибки](../../../_includes/system-errors.md) %}