# Чат-боты Битрикс24

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- нужны правки под стандарт написания
- не прописаны ссылки на ещё не созданные страницы
- из файла Сергея: это работает во внутреннем мессенджере, поддерживает открытые линии, вот такие полезные сценарии

{% endnote %}

{% endif %}

{% note tip " " %}

Бот-платформа Битрикс24 — новый формат приложений, основанных на чатах в веб-мессенджере.

{% endnote %}

## Что такое чат-боты и что они могут делать?

Что такое чат-боты, зачем они нужны и зачем вообще заниматься их разработкой?

{% note tip " " %}

**Чат-бот** — это виртуальный собеседник, программа, которая создана для имитации поведения человека при общении с одним или несколькими собеседниками.

{% endnote %}

В большей степени, этот тренд формируется сейчас за рубежом — существует огромное количество ботов для Slack или Telegram, решающих самые разные задачи — от поиска авиабилетов до управления небольшими командами разработчиков. И чтобы получить все это богатство, пользователям даже не нужно выходить из предпочитаемого мессенджера.

**Что могут делать чат-боты?**

- **Замена рутины** — позволяет выполнять определенные функции, не привлекая людей, а работа будет выполнена моментально и безупречно;
- **Поиск и агрегация** новостей, аналитики, данных (Data-Driven Collaboration), данные доступны в месте принятия решений — мессенджерах и всем участникам, которым они нужны;
- **E-commerce** — для спонтанных покупок без долгого поиска, mobile ecommerce + visual search + chatbots, для общения с клиентами;
- **Первая линия** работы с клиентами, помощники, консультанты, типовые вопросы, телефония;
- **Just for Fun** — просто для развлечения.


## Бот-платформа Битрикс24

А в _Битрикс24_ чаты (как индивидуальные, так и групповые) — это часть намного более сложной экосистемы, один из основных каналов коммуникации пользователей, полностью интегрированный с другими бизнес-инструментами. И в этом контексте использование чат-ботов открывает значительно более интересные перспективы для бизнес-пользователей, поскольку _Битрикс24_ (в браузере, десктоп- и мобильном приложениях) уже сейчас — основное рабочее место для большого количества компаний.

Очень просто написать чат-бота, который, например, будет сообщать в чат нужным пользователям срочную информацию о показателях внутренней учетной системы, интегрированной с _Битрикс24_. Можно написать чат-бота, который будет помогать курьерам удобно обрабатывать заказы на основании сделок _CRM Битрикс24_ на мобильном устройстве прямо в мессенджере — и не придется писать для них отдельное мобильное приложение.

Разработка чат-бота в _Битрикс24_ — это очень перспективный вариант быстрой и удобной автоматизации специфических бизнес-процессов. Удобной, поскольку, как мы уже выяснили, получение информации и управление через мессенджер — это то, что сейчас предпочитает массовый пользователь. А быстрой — потому что разработка чат-бота для _Битрикс24_ это довольно простой процесс.

{% note info %}

Для более четкого понимания, что могут делать чат-боты на платформе _Битрикс24_, можно посмотреть видео-примеры возможностей уже готовых чат-ботов [тут](#возможные-типы-чат-ботов-битрикс24).

{% endnote %}

{% note warning %}

Существует ограничение на создание чат-ботов в рамках rest-приложений: не более 5 на одно приложение.

{% endnote %} 

## Возможности чат-бота

Чат-бот:

- это специальный пользователь в системе, с которым можно коммуницировать в чате, но под ним никто не может авторизоваться;
- поддерживает обработку slash-команд;
- позволяет использовать свои клавиатуры для ответов, превратив простой чат в терминал.

### Slash-команды

Slash-команды позволяют быстро создавать запросы для вывода или получения какой-либо информации, форматировать сообщения.

![Пример команды](./_images/command1_sm.png)

{% note info %}

Подробнее о работе с командами можно прочитать [здесь](/learning/course/index.php?COURSE_ID=93&CHAPTER_ID=07877).

{% endnote %}

### Клавиатуры

Возможности [клавиатур](*keyboard) довольно широкие.

1. **EchoBot**

    Постраничная навигация, кнопки при вызове команды «Помощь»

    @[youtube](2v5MUeVSBX4)

2. **Марта**
   
    Просто напишите марте «Поиграй со мной!». Клавиатура используется как игровое поле:

    @[youtube](qSDKsDwJsBI)

3. **Giphy**
   
    Кнопка **Еще** позволяет без повторного введения поискового слова просматривать другие картинки на эту же тему:

    ![Еще картинки](./_images/keyboard2.png)

{% note info %}

Подробнее о работе с клавиатурами можно прочитать [здесь](/learning/course/index.php?COURSE_ID=93&LESSON_ID=7683).

{% endnote %}

### Чаты

Чат-боты могут общаться в чате почти как живые люди. Также они могут напоминать о различных событиях (о текущих задачах, встречах) или давать справочную информацию. Кроме того, что чат-боты могут писать в чаты, они могут еще создавать такие чаты и автоматически приглашать туда людей, например для обсуждения какой либо задачи.

![Чаты](./_images/features_chat1_sm.png)

{% note info %}

Подробнее о работе с чатами можно прочитать [здесь](../chats/index.md).

{% endnote %}

### Уведомления

Уведомления от чат-бота могут быть полезны и информативны. Они могут состоять из нескольких блоков различной информации из внешних систем.

![Уведомления](./_images/attach1.png)

{% note info %}

Подробнее о работе с уведомлениями можно прочитать [здесь](../chats/notifications/index.md).

{% endnote %}

## Жизненный цикл чат-бота

Чат-бот публикует свои сообщения в чат через Rest API, получает ответы и команды пользователя через [События Rest API](../events/index.md) (POST запрос).

Схема жизни чат-бота выглядит так:

![Схема жизни чат-бота](./_images/bot_life1_sm.png)

## Создание своего приложения

Основное, что нам надо понимать про чат-боты — это то, что их логика обычно строится на реагировании на некие действия пользователя и системы.

И у нас есть 6 событий, которые полностью покрывают необходимый спектр реакций:

- [ONAPPINSTALL](../common/events/on-app-install.md) — событие на установку приложения с чат-ботом.
- [ONAPPUPDATE](./events/on-app-update.md) — событие на обновление приложения.
- [ONIMJOINCHAT](./chats/events/on-imbot-join-chat.md) — событие после приглашения чат-бота «к разговору», т.е. либо при вызове его пользователем в индивидуальном чате, либо при подключении его к групповому чату.
- [ONIMBOTMESSAGEADD](./messages/events/index.md) — событие после отправки сообщения от пользователя к чат-боту (в групповом чате, при явном упоминании бота).
- [ONIMCOMMANDADD](./commands/events/index.md) — событие после отправки команды от пользователя к чат-боту (в персональной переписке с ним, или в групповом чате (если команда глобальная, то он может не участвовать в чате)).
- [ONIMBOTDELETE](./chats/events/on-imbot-delete.md) — событие после удаления приложения. Событие вызывается параллельно с [OnAppUninstall](../common/events/on-app-uninstall.md).

Иными словами, мы должны написать обработчики указанных событий, чтобы реализовать простую логику:

1. Зарегистрировать чат-бота на портале пользователя при установке.
2. Вывести приветствие-справку от имени чат-бота в момент приглашения его в чат.
3. Научиться анализировать текст сообщения от пользователя и что-то отправлять в ответ, причем под анализом подразумевается простой «разбор командной строки», а не лексический разбор естественного языка.

И для этого у нас есть набор простых методов, добавленных в REST API. Нам для старта потребуются только два:

- [imbot.register](./imbot-register.md) – регистрация чат-бота.
- [imbot.message.add](./messages/imbot-message-add.md) – отправка сообщения от чат-бота.

Очевидно, что в обработчике события [ONAPPINSTALL](../common/events/on-app-install.md) мы вызовем метод [imbot.register](./imbot-register.md) для того, чтобы добавить чат-бота на текущий портал, а затем в событии [ONIMJOINCHAT](./chats/events/on-imbot-join-chat.md) воспользуемся методом [imbot.message.add](./messages/imbot-message-add.md) для вывода справки о функционале чат-бота, и в обработчике [ONIMBOTMESSAGEADD](./messages/events/index.md) будем отвечать пользователю при помощи того же [imbot.message.add](./messages/imbot-message-add.md). Ничего сложного, согласитесь?

А также вам не придется реализовывать в приложении полноценный OAuth 2.0, поскольку параметры, необходимые для авторизации, приходят в обработчики в массиве **$_REQUEST**.

{% note info %}

Полный список методов и событий **Bot API** можно посмотреть [здесь](/learning/course/index.php?COURSE_ID=93&LESSON_ID=7895).

{% endnote %}

## Возможные типы чат-ботов Битрикс24

Для более четкого понимания, что могут делать чат-боты на платформе *Битрикс24*, приведем видео-примеры возможностей уже готовых чат-ботов. Типы чат-ботов приведены условно, вы можете создать чат-бота, который может сочетать 2 или 3 типа.

@[youtube](tcRytBQ-Gzw)

### Личный помощник

- **Марта** («1С-Битрикс») — ваш личный помощник. Она помогает искать ответы на вопросы, напоминает о встречах, с ней можно поиграть в «Крестики-нолики», и она готова просто поговорить.

### Справочная система

- **Реквизиты контрагента** («1С-Битрикс») — ищет по базе ФНС и выдает необходимую информацию.
- **Поиск24** (студия «G-Tech») — ваш личный поисковый робот. Ищет в Яндексе и выводит 5 самых точных ответов.

### Для специальных задач

- **Support Bot** («1С-Битрикс») — внутренний чат-бот для быстрого доступа к тикет-системе «Битрикс24».

### Работа с сервисами

- **OCR Bot** (First Open Systems) — распознает сканы любых документов и сохраняет их в RTF.
- **Переводчик** (PWEB) — помогает переводить тексты с одного языка на другой. Поддерживает перевод на 63 языка.
- **ЗаМКАДыш** (ИА «Инсайд») — осуществляет поиск расстояния от МКАД до необходимого адреса. Поиск расстояния рассчитывается как по прямой, так и по автодорогам.

### Работа с открытыми линиями

- **Чат-бот для Открытых линий** («1С-Битрикс») сможет выступить помощником при первом контакте с пользователем или помогать вам посреди диалога.

### Для развлечений

- **Андрейка** (PWEB) — мастер на анекдоты. Поддерживает диалог анекдотами и смешными цитатами.
- **Giphy** («1С-Битрикс») — поиск по большой библиотеке анимированных GIF-файлов, что позволяет легко найти необходимое изображение и поделиться им с коллегами.

## Смотрите также

Полный список чат-ботов для платформы *Битрикс24* можно увидеть в [одноименном разделе](https://www.bitrix24.ru/apps/?category=chat_bots) *Магазина приложений Битрикс24*.

[*keyboard]: [Клавиатура](../chats/messages/keyboards.md) — это набор кнопок, каждая кнопка может состоять из определённых ключей.