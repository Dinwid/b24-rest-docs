# Вайб и партнерские виджеты 

{% note warning "Мы еще работаем над инструментом" %}

Функционал будет выпущен в ближайшее время

{% endnote %}

Вайб — это главная страница *Битрикс24*, которая заменяет привычную Живую ленту и позволяет создавать более персонализированный интерфейс (подробности в [статье](https://helpdesk.bitrix24.ru/open/22089066/)). Администратор настраивает страницу в конструкторе из блоков аналогично тому, как это делается в Сайтах. Однако, главная страница состоит не только из блоков, но и из виджетов.

- Блок — статичный элемент, который пользователь может редактировать. Например, изменять текст или добавлять изображения.
- Виджет - динамический элемент, который отображает полученные через REST-методы данные. Виджет может быть интерактивным, например, сортировать список задач по клику или открывать слайдер страницы портала.

> Виджеты нельзя применять в обычных лендингах, магазинах или базе знаний.

## Создание виджетов

Виджеты для Вайба создаются с помощью [шаблонизатора Vue](https://vuejs.org). Это связано с тем, что они должны быть интерактивными, и обычная HTML-верстка не подходит.

При регистрации виджета партнеры передают Vue-разметку, которая затем отрисовывается шаблонизатором.

### Методы для обработчиков

Во Vue-разметке можно использовать стандартные конструкции, такие как `v-if`, `v-for`, а также обработчики `@click` или `v-on:click`. Добавлять собственные методы для обработчиков запрещено. Доступны только следующие стандартные методы:

- `fetch(?params)` — выполняет запрос к [внешнему обработчику](#anchor-handler) и  получает данные в формате JSON для наполнения виджета. Запрос может содержать параметры для авторизации.

    Пример получаемых данных:
    ```json
    '{"desc":"New description","count":420000,"persons":[
        {"name":"Person 12","age":31},
        {"name":"Person 22","age":44},
        {"name":"Person 32","age":13}s
    ]}'
    ```

    Допускается передавать обьект параметров, на основе которых будет формироваться ответ, или отправлять пустой `fetch`.
- `openApplication(?params)` — открывает слайдер текущего приложения с возможностью передачи параметров.
- `openPath(url)` — открывает локальную страницу портала по указанному URL.
    Путь внутри портала может начинаться с:
    ```text
    ^\/(crm\/(deal|lead|contact|company|type)|marketplace|company\/personal\/user\/[0-9]+|workgroups\/group\/[0-9]+)\/
    ```

## Настройка сервера для виджетов {#anchor-handler}

Партнер должен настроить сервер (`handler`), чтобы виджет получил данные методом `fetch`. Сервер  запрашивает данные с портала через REST-методы и должен быть доступен по публичному адресу. Можно использовать отдельный `handler` для каждого виджета или один адрес с параметрами. Например:

- `parner.site/vibe` и использовать `fetch({command: 'getTasks'})`, `fetch({command: 'getUsers'})`
- `parner.site/vibe.tasks.get` и `parner.site/vibe.users.get`

## Процесс запроса данных

1. При открытии страницы или вызове Vue-обработчика виджет отправляет запрос к `handler`.
2. `Handler` делает REST-запрос на портал и получает необходимые данные.
3. Виджет получает в ответ данные и присваивает их реактивным переменным.
4. Виджет перерисовывается в соответствии с новыми данными.

## Методы для работы с виджетами

#|
|| **Метод** | **Описание** ||
|| [landing.reporepowidget.register](./landing-repowidget-register.md) | Метод добавляет виджет ||
|| [landing.reporepowidget.unregister](./landing-repowidget-unregister.md) | Метод удаляет виджет ||
|#